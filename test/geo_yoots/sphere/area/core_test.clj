(ns geo-yoots.sphere.area.core-test
  (:require [clojure.test :refer :all]
            [clojure.core.matrix :as mtx]  
            [geo-yoots.test-util :as test.util]
            [geo-yoots.constants :as geo.const]
            [geo-yoots.util.core :as geo.util]
            [geo-yoots.sphere.area.core :as geo.sphere.area]))



;; ===========================
;; -  Rotation Matrix Tests  -
;; ===========================

;; TBD



;; =========================
;; -  Shoelace Aglo Tests  -
;; =========================

;; Testcase Source: https://en.wikipedia.org/wiki/Shoelace_formula

;; ===========
;; -  Cases  -
;; -----------

(def mtx1
  (hash-map
    :mtx  (mtx/matrix
            [[2  4]
             [3 -8]
             [1  2]])
    :area 7.0))


(def mtx2
  (hash-map
    :mtx  (mtx/matrix
            [[ 3  4]
             [ 5 11]
             [12  8]
             [ 9  5]
             [ 5  6]])
    :area 30.0))

(def mtx3
  (hash-map
    :mtx  (mtx/matrix
            [[ 2  7]
             [10  1]
             [ 8  6]
             [11  7]
             [ 7 10]])
    :area 32.0))


;; ===========
;; -  Tests  -
;; -----------

(deftest shoelace-apply-test
  (let [cases [mtx1 mtx2 mtx3]]
    (testing "Matrices"
      (doseq [[i _case] (map list (range (count cases)) cases)]
        (testing (format "Case: %d" i)
          (is (= (geo.sphere.area/apply-shoelace (:mtx _case)) (:area _case))))))))


;; ================
;; -  Area Tests  -
;; ================

;; ==========
;; -  Cases -
;; ----------

(def poly1
  (hash-map
    :poly [[ 1.000000  0.000000]
           [ 0.000000  1.000000]
           [-1.000000  0.000000]
           [ 0.000000 -1.000000]]
    :area 24740.08))

(def poly2
  (hash-map
    :poly [[-15.290669  179.159774]
           [-11.469978  179.626362]
           [ -9.559677 -177.255858]
           [-13.678565 -174.857297]
           [-17.228967 -177.598549]]
    :area 338550.27))

(def poly3
  (hash-map
    :poly [[29.99906170493383 -90.42725561653577]
           [29.99533640496636 -90.42696669066818]
           [29.99335867823883 -90.41534213633119]
           [29.99018024847489 -90.40729174699797]
           [29.98605085649548 -90.40184120993824]
           [29.98085079882353 -90.39800724559494]
           [29.97928333955896 -90.39690344594437]
           [29.98075305584882 -90.39218453030135]
           [29.98740135552484 -90.39608179446184]
           [29.99207957444455 -90.39965704606774]
           [29.99557763234701 -90.40881580618841]
           [29.99800787798624 -90.41721422776384]
           [29.99906170493383 -90.42725561653577]]
    :area 1.93))

(def poly4
  (hash-map
    :poly [[29.993094999999997 -90.460828]
           [29.992001000000002 -90.454835]
           [29.990195999999997 -90.446007]
           [29.99019           -90.43206]
           [29.994350999999995 -90.432192]
           [29.994384999999994 -90.434352]
           [29.995379          -90.445602]
           [29.996012000000007 -90.451396]
           [29.997289999999992 -90.45873]
           [29.997392000000005 -90.458726]
           [29.997392000000005 -90.45888]
           [29.997426000000004 -90.459535]
           [29.993094999999997 -90.460828]]
    :area 1.41))

(def poly5
  (hash-map
    :poly [[52.971092          4.7655129999999986]
           [52.95706000000001  4.764809000000014]
           [52.95607699999999  4.769634999999994]
           [52.942519000000004 4.772424000000001]
           [52.94242299999999  4.7877929999999935]
           [52.94961699999999  4.793407000000002]
           [52.95269300000001  4.788003000000003]
           [52.95866000000001  4.804949999999991]
           [52.970844          4.800051999999994]
           [52.971092          4.7655129999999986]]
    :area 6.146))

(def poly6
  (hash-map
    :poly [[17.695130000000006 83.26754399999999]
           [17.687502999999992 83.277581]
           [17.686155          83.28386499999999]
           [17.686318          83.291676]
           [17.690638000000007 83.29215099999999]
           [17.693826          83.284854]
           [17.694616999999994 83.28119300000003]
           [17.705155000000005 83.279695]
           [17.706817          83.277716]
           [17.713992000000005 83.27290199999999]
           [17.714690000000004 83.26904200000001]
           [17.70894           83.26161400000001]
           [17.695130000000006 83.26754399999999]]
    :area 4.69))

(def poly7
  (hash-map
    :poly [[19.98498475616872 -91.79134362468773]
           [19.9740615493575  -92.04057221275009]
           [20.03541307963264 -92.14643923513471]
           [19.95465060060891 -92.65622000414476]
           [19.45081690538742 -92.5158885284788]
           [19.66032206271934 -91.76904227116374]
           [19.98498475616872 -91.79134362468773]]
    :area 4209.65))

(def poly8
  (hash-map
    :poly [[45.61253720661773 13.76805534791982]
           [45.6081753117228  13.77841955800301]
           [45.61382065985224 13.78507279772183]
           [45.61654418007323 13.77955383415076]
           [45.61253720661773 13.76805534791982]]
    :area 0.61))

(def poly9
  (hash-map
    :poly [[34.23897057428315 132.5638278053062]
           [34.2616479343     132.524814256]
           [34.260657554      132.515103735]
           [34.2496936292     132.512478625]
           [34.2356858612     132.529040195]
           [34.2223250083     132.51815939]
           [34.2096925593     132.531038298]
           [34.22741372813305 132.5547173987204]
           [34.23331328810249 132.5467411848424]
           [34.23754922026851 132.5505916255833]
           [34.23731528410036 132.5547430421426]
           [34.23449131109498 132.5599368463871]
           [34.23897057428315 132.5638278053062]]
    :area 13.12))

(def poly10
  (hash-map
    :poly [[2.988796580801094 101.4027996541245]
           [3.045382892157539 101.3796574154713]
           [3.056749706005817 101.3581881735915]
           [3.080301624046995 101.3491098257278]
           [3.12320917128509  101.3089142074387]
           [3.109044296918606 101.2935373933977]
           [3.064111381047294 101.3359961658755]
           [3.052526194703154 101.3388075055149]
           [3.001018576505298 101.340942216169]
           [2.98341169508234  101.3109068220205]
           [2.922723283922333 101.2789262903789]
           [2.908721947908669 101.2862037356386]
           [2.953388875062547 101.3285886380902]
           [2.988796580801094 101.4027996541245]]
    :area 99.24))

(def poly11
  (hash-map
    :poly [[89.000000    0.000000]
           [89.000000   90.000000]
           [89.000000 -180.000000]
           [89.000000  -90.000000]]
    :area 24775.83))

(def poly12
  (hash-map
    :poly [[ 0.000000 -179.000000]
           [-1.000000  180.000000]
           [ 0.000000  179.000000]
           [ 1.000000  180.000000]]
    :area 24764.63))

(def poly13
  (hash-map
    :poly [[-89.000000   0.000000]
           [-89.000000  90.000000]
           [-89.000000 180.000000]
           [-89.000000 -90.000000]]
    :area 24723.95))

(def poly14
  (hash-map
    :poly  [[22.64177070169907 69.75413169317234]
            [22.55441799820071 69.78512972567495]
            [22.59451481917201 69.89665084557285]
            [22.64648834183183 69.9747809917837]
            [22.66621642581892 69.96854358414114]
            [22.6774491582317  69.9416513993332]
            [22.67167379152868 69.92358978026273]
            [22.65197260421426 69.79171243233166]
            [22.64381096254719 69.75228632187711]
            [22.64177070169907 69.75413169317234]]
    :area  170.00))

(def poly15
  (hash-map
    :poly [[23.07428450866782 70.22521415038149]
           [23.07435242855946 70.19155461197418]
           [23.02845754181432 70.16938610727347]
           [22.97075941021901 70.18778812303904]
           [22.92499646785887 70.11929763191874]
           [22.89946606841999 70.06942204157939]
           [22.8921191591628  69.96625975225665]
           [22.83663229827625 69.7863699546305]
           [22.81096348359654 69.7538232481763]
           [22.66767732007818 69.74795246738863]
           [22.73831827809595 70.04018934945803]
           [22.8212655661419  70.21750313650708]
           [22.89582888702938 70.27565303676418]
           [22.93951122049624 70.30711190279004]
           [23.07428450866782 70.22521415038149]]
    :area 1030.75))

(def poly16
  (hash-map
    :poly [[75.6914914701747  18.66454162379526]
           [76.89254771447705 21.07488570438129]
           [76.39045000892995 26.26250406731429]
           [78.32087828390017 28.27458981985545]
           [79.14045125496244 33.45393633367215]
           [80.47115620385789 36.08169717918778]
           [80.97958191056382 32.4714935955152]
           [80.69961142315485 28.13494487188955]
           [81.40157521054088 19.80062827107594]
           [80.63711791246881 13.83472663767331]
           [80.25707118838696 7.409688406730817]
           [77.7852428643377  9.548657785981124]
           [75.67155735296186 16.22005216495822]
           [75.6914914701747  18.66454162379526]]
    :area 229618.19))

(def poly17
  (hash-map
    :poly  [[25.3084516319 56.4280950971]
            [25.2371431621 56.431986105]
            [25.0760075471 56.44722975889999]
            [25.0158989981 56.5042375703]
            [25.0482045552 56.622385252]
            [25.1603570442 56.7189134617]
            [25.3905972974 56.7649934097]
            [25.5058879544 56.7646622762]
            [25.5054716162 56.6306514665]
            [25.4596658449 56.5102409498]
            [25.4021058337 56.46425547379999]
            [25.3084516319 56.4280950971]]
    :area  1409.51))


; ---

(def circles
  (list
    {:r 1  :area    3.14}
    {:r 2  :area   12.57}
    {:r 3  :area   28.27}
    {:r 5  :area   78.54}
    {:r 8  :area  201.06}
    {:r 13 :area  530.93}
    {:r 21 :area 1385.44}
    {:r 34 :area 3631.68}))


;; ===========
;; -  Tests  -
;; -----------

(deftest polygon-area-test
  (let [cases [poly1 poly2 poly3 poly4 poly5 poly6 poly7 poly8 poly9 poly10 poly11 poly12 poly13 poly14 poly15 poly16 poly17]]
    (doseq [[i _case] (map list (range (count cases)) cases)]
      (testing (format "Polygon Area Case: %d" i)
        (test.util/compare-area (:area _case) (geo.sphere.area/polygon (:poly _case)))))))

(deftest circle-area-test
  (let [cases circles]
    (doseq [[i _case] (map list (range (count cases)) cases)]
      (testing (format "Circle Area Case: %d" i)
        (println (format "ACTUAL=%s, EXPECTED=%s" (test.util/round-float (geo.sphere.area/circle (:r _case)) 2) (:area _case)))
        (is (= (test.util/round-float (geo.sphere.area/circle (:r _case)) 2) (float (:area _case))))))))
